# Техническое задание: генерация школьного расписания

## Глоссарий

* **Класс** — группа учеников одного года обучения (например, 5А).
* **Подгруппа** — деление класса на 2 части для отдельных предметов.
* **Слот** — комбинация дня и урока (например, понедельник, 3-й урок).
* **Учебный план** — количество часов в неделю, которое должно быть проведено по каждому предмету в конкретный год обучения.
* **Сложный предмет** — предмет, требующий высокой концентрации (например, математика, физика, иностранный язык).

---

## 1. Исходные данные

1. **Предметы**

   * Загружаются из базы данных.
   * Примеры: математика, информатика, английский, труд, физкультура.
   * Каждый предмет имеет атрибуты: идентификатор, название, уровень сложности, признак «делится на подгруппы».

2. **Учителя**

   * Каждый учитель может преподавать один или несколько предметов.
   * Каждому учителю назначается уникальный идентификатор.
   * Для каждого учителя хранится список дней, когда он доступен.
   * Пример: Иванов преподаёт алгебру и геометрию.

3. **Годы обучения**

   * С **5 по 11 классы**.

4. **Классы**

   * Например: 5А, 5Б, 6А, … 11Б.
   * У каждого класса есть уникальный идентификатор, параллель и буква.

5. **Учебный план**

   * Для каждого класса задано количество часов в неделю по каждому предмету (целое число).
   * Для ряда предметов (иностранный язык, информатика, труд) уроки проводятся в **подгруппах**.

6. **Подгруппы**

   * Класс делится на подгруппы 1 и 2, причём деление применяется только для предметов: иностранный язык, информатика, труд.
   * В подгруппах занятия могут одновременно проходить по совместимым предметам:

     * иностранный язык ↔ иностранный язык
     * информатика ↔ иностранный язык
     * труд ↔ труд
   * Если занятия проводятся в подгруппах, желательно, чтобы они сразу проводились у обеих подгрупп (1 и 2).
   * Уроки подгрупп должны синхронизироваться по времени и не пересекаться с общими уроками класса.

7. **Закрепление учителей**

   * За каждым классом и предметом закрепляется конкретный учитель.
   * Если предмет проводится в подгруппах — закрепляется учитель за каждой подгруппой.

---

## 2. Ограничения расписания

### 2.1 Общее расписание

* Учёба проводится **5 дней в неделю**.
* Не более **7 уроков в день**.
* Уроки начинаются и заканчиваются в фиксированные временные интервалы.

### 2.2 Учителя

* Каждый учитель ведёт не более **35 уроков в неделю**.
* Учитель может заранее указать дни, в которые он **не ведёт занятия**. В эти дни все переменные, связанные с данным учителем, равны 0.
* В один слот учитель может вести только один урок.

### 2.3 Классы и предметы

* В один день у класса может быть **не более одного урока одного и того же предмета**.
* Количество уроков должно совпадать с учебным планом.
* Уроки одного предмета распределяются равномерно по разным дням недели, без концентрации в один день.
* Сложные предметы желательно ставить в первые уроки дня.

### 2.4 Подгруппы

* Уроки подгрупп согласуются с общим расписанием класса.
* Совместимые предметы могут ставиться одновременно (например, одна подгруппа — информатика, другая — труд).
* Подгруппы одного класса не могут иметь больше одного общего предмета в один слот, кроме случаев совместимости.
* Если предмет проводится в подгруппах, занятия проводятся одновременно у обеих подгрупп.

---

## 3. Формализация для MILP

### 3.1 Переменные

* `x[c, p, d, h]` — бинарная переменная, равная 1, если у класса `c` есть предмет `p` в день `d` на уроке `h`.
* `x[c, g, p, d, h]` — бинарная переменная для подгруппы `g`.
* `y[t, d, h]` — бинарная переменная, равная 1, если учитель `t` ведёт урок в день `d` на уроке `h`.

### 3.2 Ограничения

1. **Учебный план:** ∑\_{d,h} x\[c, p, d, h] = требуемые часы по предмету `p` для класса `c`.
2. **Слот класса:** ∑\_{p} x\[c, p, d, h] ≤ 1 (не более одного предмета в слот).
3. **Слот учителя:** ∑\_{c,p} x\[c, p, d, h] ≤ 1 (учитель ведёт не более одного урока в слот).
4. **Нагрузка учителя:** ∑\_{d,h,c,p} x\[c, p, d, h] ≤ 35 для каждого учителя.
5. **Запрещённые дни учителя:** x\[c, p, d, h] = 0, если учитель недоступен в день `d`.
6. **Ограничение по предмету в день:** ∑\_{h} x\[c, p, d, h] ≤ 1.
7. **Согласование подгрупп:** уроки подгрупп синхронизируются с расписанием класса; совместимые предметы могут идти одновременно.
8. **Деление на подгруппы:** применяется только для: иностранный язык, информатика, труд.
9. **Одновременность подгрупп:** если предмет проводится в подгруппах — желательно, чтобы занятия шли у обеих подгрупп.
10. **Баланс нагрузки:** уроки распределяются так, чтобы минимизировать перегрузки в отдельные дни.

### 3.3 Целевая функция (опционально)

* Минимизировать количество «окон» у классов и учителей.
* Сбалансировать распределение предметов по неделе.
* Избегать сложных предметов в последние слоты.
* Не ставить два сложных предмета подряд.
* Максимально учитывать предпочтения учителей и классов.

---

## 4. Технические детали реализации

* **Язык:** Python.
* **Инструменты:** бесплатные MILP-солверы (CBC, GLPK, OR-Tools).
* **Подготовка данных:** загрузка предметов, учителей, классов и учебного плана из базы данных. Данные должны иметь идентификаторы (например, JSON, SQL или CSV-таблицы).
* **Формализация:** уравнения можно описывать в `SymPy` и преобразовывать в матричную форму, либо напрямую строить модель через `PuLP` / `OR-Tools`.
* **Выход:** оптимизированное расписание с распределением уроков по дням и часам для всех классов и учителей. Результат сохраняется в удобном формате (например, Excel или PDF).

---

## 5. Чеклист для проверки готового расписания

### Общие требования

* [ ] Учёба проводится 5 дней в неделю.
* [ ] В каждом дне не более 7 уроков.

### Учителя

* [ ] У каждого учителя не более 35 уроков в неделю.
* [ ] У учителя не более одного урока в один слот.
* [ ] В запрещённые дни у учителя нет уроков.

### Классы

* [ ] Для каждого класса количество уроков по каждому предмету соответствует учебному плану.
* [ ] В один день у класса не более одного урока по одному предмету.
* [ ] Распределение предметов равномерное по неделе.
* [ ] Сложные предметы стоят преимущественно в начале дня.

### Подгруппы

* [ ] Деление применяется только для: иностранный язык, информатика, труд.
* [ ] Уроки подгрупп согласованы с расписанием всего класса.
* [ ] Совместимые предметы могут идти одновременно.
* [ ] Если предмет проводится в подгруппах, занятия проводятся одновременно у обеих подгрупп.

### MILP-модель

* [ ] Все ограничения формализованы в уравнениях.
* [ ] Переменные заданы для классов, подгрупп и учителей.
* [ ] Учтены ограничения по слотам, дням, предметам и учителям.
* [ ] Баланс нагрузки по дням соблюдается.

### Целевая функция

* [ ] Минимизировано количество «окон» у классов и учителей.
* [ ] Обеспечено равномерное распределение предметов.
* [ ] Сложные предметы не ставятся подряд и в конце дня.
* [ ] Учтены предпочтения учителей.
